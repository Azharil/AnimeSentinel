sudo: false
language: php
php:
  - '5.6'
  - '7.0'
  - hhvm
  - nightly
env:
  - DB=sqlite
  - DB=mysql
  - DB=postgres
matrix:
  allow_failures:
  - php:
    - '5.6'
    - hhvm
    - nightly
  - env:
    - DB=sqlite
    - DB=mysql

services:
  - mysql
  - postgresql

addons:
  apt:
    packages:
    - python-pip
    - ffmpeg

before_install:
  - nvm install 6
  - mysql -e 'SET @@global.sql_mode="";'
  - mysql -e 'create database travis_ci_test;'
  - psql -c 'create database travis_ci_test;' -U postgres
  - openssl aes-256-cbc -K $encrypted_5f496bf5950e_key -iv $encrypted_5f496bf5950e_iv -in .env.travis.tar.enc -out .env.travis.tar -d
  - tar xvf .env.travis.tar
  - sh -c "if [ '$DB' = 'sqlite' ]; then cp .env.travis.sqlite .env; fi"
  - sh -c "if [ '$DB' = 'mysql' ]; then cp .env.travis.mysql .env; fi"
  - sh -c "if [ '$DB' = 'postgres' ]; then cp .env.travis.pgsql .env; fi"
install:
  - composer create-project
  - npm install
  - pip install --user cfscrape
  - pip install --user selenium
  - php artisan migrate --seed
  - node ./node_modules/gulp/bin/gulp.js --production
before_script:
  - cat .env
  - php -v
  - npm -v
  - node -v
  - python -V

cache:
  pip: true
  directories:
  - vendor
  - node_modules
